import{u as E,r as N,H as U,w as i,ac as f,v as h,t as D,j as c,m as M,S as b,a as n,L as e,ay as J,C as d,cB as B,b as y,ao as z,ap as Q,z as Z,a3 as ee,c2 as te,al as ne,f as ae,A as Y,P as x,N as se,a2 as L,I as ie,aj as re,X as oe,ad as le,q as V,d as _,cw as ce,a9 as Ae,x as F,K as G}from"./index-970d8b36.js";const X={username:"lb",channels:[{id:1,name:"guns",members:7,lastMessage:"i have a draco, 2k",sender:"kevin",timestamp:Date.now()-1e3*60*60*4},{id:2,name:"comics",members:134,lastMessage:"whats up, i found this really great comic the other day",sender:"anonymous943",timestamp:Date.now()-1e3*60*60*8},{id:3,name:"cars",members:23,lastMessage:"i have a 2019 mustang for sale",sender:"pirateking32",timestamp:Date.now()-1e3*60*60*12}],messages:{guns:[{content:"i have a draco, 2k",sender:"kevin",timestamp:Date.now()-1e3*60*60*4},{content:"yo, does anyone have any weapons for sale?",sender:"rya2n",timestamp:Date.now()-1e3*60*60*6},{content:"sup",sender:"lb",timestamp:Date.now()-1e3*60*60*17}],comics:[{content:"whats up, i found this really great comic the other day",sender:"anonymous943",timestamp:Date.now()-1e3*60*60*8},{content:"any good cominc recommendations?",sender:"yungblood",timestamp:Date.now()-1e3*60*60*10},{content:"just finished reading the new batman comic, its amazing",sender:"batmanfan123",timestamp:Date.now()-1e3*60*60*24}],cars:[{content:"i have a 2019 mustang for sale",sender:"pirateking32",timestamp:Date.now()-1e3*60*60*12},{content:"anyone know where i can get a good deal on a car?",sender:"anonymous",timestamp:Date.now()-1e3*60*60*14},{content:"i have a 2018 camaro for sale, 15k",sender:"camaroguy",timestamp:Date.now()-1e3*60*60*18},{content:"i have a 2017 mustang for sale, 10k",sender:"mustangguy",timestamp:Date.now()-1e3*60*60*20},{content:"looking for a quite new car in good condition for around 10k, anyone know where i can find one?",sender:"lb",timestamp:Date.now()-1e3*60*60*22}]}};function Pe(){var K,I;const r=E(u),P=E(R),C=E(Y),[l,S]=N.useState(""),[o,m]=N.useState(""),T=E(x.Settings),p=E(i.APPS.DARKCHAT.channels);N.useEffect(()=>{if(U("DarkChat")&&!i.APPS.DARKCHAT.channels.value){if(!f())return h("warning","No service, not fetching channels");D("DarkChat",{action:"getChannels"},X.channels).then(A=>{if(!A)return h("warning","Failed to fetch channels");i.APPS.DARKCHAT.channels.set(A)})}},[C==null?void 0:C.active,P]);const v=()=>{D("AccountSwitcher",{action:"getAccounts",app:"DarkChat"},null).then(A=>{var a;if(!A)return h("info","No accounts found");let t=(a=A==null?void 0:A.filter(s=>s!==P))==null?void 0:a.map(s=>({title:s,cb:()=>{D("AccountSwitcher",{action:"switch",app:"DarkChat",account:s}).then(()=>{R.set(s),i.APPS.DARKCHAT.username.set(s),i.APPS.DARKCHAT.channels.reset(),u.set("channels")})}}));d.ContextMenu.set({buttons:[{title:P},...t,{title:e("APPS.DARKCHAT.CHANGE_ACCOUNT"),cb:()=>{u.set("signup"),R.reset(),i.APPS.DARKCHAT.username.reset(),i.APPS.DARKCHAT.channels.reset()}},{title:e("APPS.MAIL.SIGN_OUT_POPUP.TITLE"),color:"red",cb:()=>{d.PopUp.set({title:e("APPS.MAIL.SIGN_OUT_POPUP.TITLE"),description:e("APPS.MAIL.SIGN_OUT_POPUP.DESCRIPTION"),buttons:[{title:e("APPS.MAIL.SIGN_OUT_POPUP.CANCEL")},{title:e("APPS.MAIL.SIGN_OUT_POPUP.PROCEED"),color:"red",cb:()=>{D("DarkChat",{action:"logout"},!0).then(s=>{if(!s)return h("warning","Failed to logout, success returned false");R.reset(),i.APPS.DARKCHAT.username.reset(),i.APPS.DARKCHAT.channels.reset(),u.set("signin")})}}]})}}]})})},w=()=>{let A="";d.PopUp.set({title:e("APPS.DARKCHAT.JOIN_ROOM"),description:e("APPS.DARKCHAT.JOIN_ROOM_TEXT"),input:{placeholder:e("APPS.DARKCHAT.ROOM_CODE"),type:T!=null&&T.streamerMode?"password":"text",minCharacters:3,onChange:t=>A=t},buttons:[{title:e("APPS.DARKCHAT.CANCEL")},{title:e("APPS.DARKCHAT.JOIN"),color:"blue",cb:()=>{if(!f()){h("warning","No service, not joining channel"),d.PopUp.set({title:e("MISC.AIRPLANE_MODE_POPUP.TITLE"),description:e("MISC.AIRPLANE_MODE_POPUP.DESCRIPTION"),buttons:[{title:e("MISC.AIRPLANE_MODE_POPUP.OK")}]});return}return D("DarkChat",{action:"joinChannel",channel:A},"password_required").then(t=>{if(!t)return h("warning","Failed to join channel");if(t==="invalid_channel")return d.PopUp.set({title:e("APPS.DARKCHAT.INVALID_CHANNEL"),description:e("APPS.DARKCHAT.INVALID_CHANNEL_TEXT"),buttons:[{title:e("APPS.DARKCHAT.OK")}]});if(t==="already_in_channel")return d.PopUp.set({title:e("APPS.DARKCHAT.ALREADY_IN_CHANNEL"),description:e("APPS.DARKCHAT.ALREADY_IN_CHANNEL_TEXT"),buttons:[{title:e("APPS.DARKCHAT.OK")}]});if(t==="password_required"){let a="";d.PopUp.set({title:e("APPS.DARKCHAT.PASSWORD_REQUIRED"),description:e("APPS.DARKCHAT.PASSWORD_REQUIRED_TEXT"),input:{placeholder:e("APPS.DARKCHAT.PASSWORD_PLACEHOLDER"),type:"password",onChange:s=>a=s},buttons:[{title:e("APPS.DARKCHAT.CANCEL")},{title:e("APPS.DARKCHAT.JOIN"),color:"blue",cb:()=>{D("DarkChat",{action:"joinChannel",channel:A,password:a},{timestamp:Date.now(),name:A,members:Math.floor(Math.random()*100),lastMessage:"Welcome to the channel!",sender:"admin"}).then(s=>{if(!s)return h("warning","Failed to join channel");if(s==="incorrect_password")return d.PopUp.set({title:e("APPS.DARKCHAT.INCORRECT_PASSWORD"),description:e("APPS.DARKCHAT.INCORRECT_PASSWORD_TEXT"),buttons:[{title:e("APPS.DARKCHAT.OK")}]});O.set(s),u.set("chat"),i.APPS.DARKCHAT.channels.set([s,...p])})}}]});return}O.set(t),u.set("chat"),i.APPS.DARKCHAT.channels.set([t,...p])}),o}}]})},k=()=>{let A="",t="";d.PopUp.set({title:e("APPS.DARKCHAT.CREATE_ROOM"),description:e("APPS.DARKCHAT.CREATE_ROOM_TEXT"),inputs:[{placeholder:e("APPS.DARKCHAT.ROOM_CODE"),type:"text",minCharacters:3,onChange:a=>A=a},{placeholder:e("APPS.DARKCHAT.PASSWORD_PLACEHOLDER_OPTIONAL"),type:"password",onChange:a=>t=a}],buttons:[{title:e("APPS.DARKCHAT.CANCEL")},{title:e("APPS.DARKCHAT.CREATE"),color:"blue",cb:()=>{D("DarkChat",{action:"createChannel",channel:A,password:(t==null?void 0:t.length)>0?t:null},{timestamp:Date.now(),name:A,members:1}).then(a=>{if(!a)return h("warning","Failed to create channel");if(a==="channel_exists")return d.PopUp.set({title:e("APPS.DARKCHAT.CHANNEL_EXISTS"),description:e("APPS.DARKCHAT.CHANNEL_EXISTS_TEXT"),buttons:[{title:e("APPS.DARKCHAT.OK")}]});if(a==="invalid_name")return d.PopUp.set({title:e("APPS.DARKCHAT.INVALID_NAME"),description:e("APPS.DARKCHAT.INVALID_NAME_TEXT"),buttons:[{title:e("APPS.DARKCHAT.OK")}]});if(a==="unknown_error")return d.PopUp.set({title:e("APPS.DARKCHAT.UNKNOWN_ERROR"),description:e("APPS.DARKCHAT.UNKNOWN_ERROR_TEXT"),buttons:[{title:e("APPS.DARKCHAT.OK")}]});O.set(a),u.set("chat"),i.APPS.DARKCHAT.channels.set([a,...p])})}}]})};return c(M.div,{...b("left",r,.2),className:"animation-container",children:[c("div",{className:"darkchat-header",children:[c("div",{className:"top",children:[n("div",{className:"title",children:e("APPS.DARKCHAT.TITLE")}),c("div",{className:"buttons",children:[n(J,{onClick:()=>{P&&d.ContextMenu.set({buttons:[{title:e("APPS.DARKCHAT.JOIN_ROOM"),cb:w},{title:e("APPS.DARKCHAT.CREATE_ROOM"),cb:k}]})}}),n(B,{className:"elipse",onClick:()=>{var A,t,a,s;d.ContextMenu.set({buttons:[{title:e("APPS.DARKCHAT.CHANGE_ACCOUNT"),cb:v},((t=(A=y)==null?void 0:A.value)==null?void 0:t.ChangePassword.DarkChat)&&{title:e("APPS.DARKCHAT.CHANGE_PASSWORD"),cb:()=>z("DarkChat",()=>{})},((s=(a=y)==null?void 0:a.value)==null?void 0:s.DeleteAccount.DarkChat)&&{title:e("APPS.DARKCHAT.DELETE_ACCOUNT"),color:"red",cb:()=>{Q("DarkChat",()=>{R.reset(),i.APPS.DARKCHAT.username.set(null),i.APPS.DARKCHAT.channels.set(null),u.set("signin")})}}]})}})]})]}),n(Z,{placeholder:e("APPS.DARKCHAT.SEARCH"),theme:"dark",onChange:A=>S(A.target.value)})]}),(p==null?void 0:p.length)===0&&c("div",{className:"no-channels",children:[n("div",{className:"title",children:e("APPS.DARKCHAT.NO_CHATS")}),n("div",{className:"description",children:e("APPS.DARKCHAT.NO_CHATS_TEXT")})]}),n("div",{className:"channels-body",children:(I=(K=p==null?void 0:p.sort((A,t)=>t.timestamp-A.timestamp))==null?void 0:K.filter(A=>{var t;return(t=A.name)==null?void 0:t.toLowerCase().includes(l==null?void 0:l.toLowerCase())}))==null?void 0:I.map(A=>n(de,{channel:A},A.id))})]})}const de=({channel:r})=>{const P=E(R),C=E(x.Settings),l=o=>/<!SENT-LOCATION-X=(-?\d*\.?\d*)Y=(-?\d*\.?\d*)!>/.test(o),S=ee(o=>{d.ContextMenu.set({buttons:[{title:e("APPS.DARKCHAT.LEAVE_CHANNEL.TITLE"),color:"red",cb:()=>{d.PopUp.set({title:e("APPS.DARKCHAT.LEAVE_CHANNEL.TITLE"),description:e("APPS.DARKCHAT.LEAVE_CHANNEL.DESCRIPTION"),buttons:[{title:e("APPS.DARKCHAT.LEAVE_CHANNEL.CANCEL")},{title:e("APPS.DARKCHAT.LEAVE_CHANNEL.PROCEED"),cb:()=>{D("DarkChat",{action:"leaveChannel",channel:r.name},!0).then(m=>{if(!m)return h("warning","Failed to leave channel");u.set("channels"),O.set(null);let T=i.APPS.DARKCHAT.channels.value.filter(p=>p.name!==r.name);i.APPS.DARKCHAT.channels.set(T)})}}]})}}]})});return c("div",{...S,className:"channel",onClick:()=>{P&&(O.set(r),u.set("chat"))},children:[c("div",{className:"channel-info",children:[c("div",{className:"members",children:[n(te,{}),n("span",{children:r.members})]}),c("div",{className:"channel-content",children:[n("div",{className:"channel-name",children:C.streamerMode?"*****":r.name}),r.lastMessage&&c("div",{className:"recent-message",children:[c("b",{children:[r.sender,":"]})," ",l(r.lastMessage)?e("APPS.MESSAGES.SENT_LOCATION_SHORT"):r.lastMessage]})]})]}),c("div",{className:"right",children:[n("div",{className:"timestamp",children:ne(r.timestamp)}),n(ae,{})]})]})};function he(){const r=E(x.Settings),P=E(O),C=E(R),l=E(u),S=E(d.Emoji),[o,m]=N.useState([]),[T,p]=N.useState(""),v=N.useRef(null),w=N.useRef(0);N.useEffect(()=>{var t;if(U("DarkChat")){if(!f())return h("warning","No service, not fetching messages");D("DarkChat",{action:"getMessages",channel:P.name},(t=X.messages)==null?void 0:t[P.name]).then(a=>{if(!a)return h("error","Failed to fetch messages");m(a.reverse())})}},[]);const{handleScroll:k}=se({fetchData:()=>{var t;return D("DarkChat",{action:"getMessages",channel:P.name,lastId:(t=o[0])==null?void 0:t.id})},onDataFetched:t=>{let a=document.querySelector(".chat-wrapper");w.current=a.scrollHeight,m(s=>[...t.reverse(),...s])},isReversed:!0,perPage:15});N.useEffect(()=>{let t=document.querySelector(".chat-wrapper");if(!t)return;const a=t.scrollHeight;t.scrollTop+=a-w.current},[o]);const K=()=>{if(!f()){d.PopUp.set({title:e("MISC.AIRPLANE_MODE_POPUP.TITLE"),description:e("MISC.AIRPLANE_MODE_POPUP.DESCRIPTION"),buttons:[{title:e("MISC.AIRPLANE_MODE_POPUP.OK")}]}),h("warning","No service, not sending message");return}if(T.length>0){let t={sender:C,content:T,timestamp:new Date().getTime()};D("DarkChat",{action:"sendMessage",content:T,channel:P.name},!0).then(()=>{p(""),v.current.value="",m([...o,t]);let a=i.APPS.DARKCHAT.channels.value.map(s=>(s.name===P.name&&(s.lastMessage=t.content,s.sender=C,s.timestamp=new Date().getTime()),s));i.APPS.DARKCHAT.channels.set(a)})}},I=()=>{d.PopUp.set({title:e("APPS.MESSAGES.SEND_LOCATION_POPUP.TITLE"),description:e("APPS.MESSAGES.SEND_LOCATION_POPUP.TEXT"),buttons:[{title:e("APPS.MESSAGES.SEND_LOCATION_POPUP.CANCEL")},{title:e("APPS.MESSAGES.SEND_LOCATION_POPUP.SEND"),cb:()=>{if(!f()){d.PopUp.set({title:e("MISC.AIRPLANE_MODE_POPUP.TITLE"),description:e("MISC.AIRPLANE_MODE_POPUP.DESCRIPTION"),buttons:[{title:e("MISC.AIRPLANE_MODE_POPUP.OK")}]}),h("warning","No service, not sending location");return}D("Maps",{action:"getCurrentLocation"},{x:"0",y:"0"}).then(t=>{if(!t)return;let a={content:`<!SENT-LOCATION-X=${F(t.x,2)}Y=${F(t.y,2)}!>`,sender:C,timestamp:new Date().getTime()};D("DarkChat",{action:"sendMessage",...a,channel:P.name},!0).then(s=>{if(s){p(""),v.current.value="";let H=i.APPS.DARKCHAT.channels.value.map(g=>(g.name===P.name&&(g.lastMessage=a.content,g.sender=C,g.timestamp=new Date().getTime()),g));i.APPS.DARKCHAT.channels.set(H)}else m(H=>[...H,{...a,delivered:!1}])})})}}]})};L("darkChat:newMessage",t=>{if(P.name!==t.channel||!U("DarkChat"))return;let a=i.APPS.DARKCHAT.channels.value.map(s=>(s.name===t.channel&&(s.lastMessage=t.content,s.sender=t.sender,s.timestamp=new Date().getTime()),s));i.APPS.DARKCHAT.channels.set(a),m([...o,{...t,timestamp:new Date().getTime()}])},{waitUntilService:!0});const A=t=>{if(t)return/<!SENT-LOCATION-X=(-?\d*\.?\d*)Y=(-?\d*\.?\d*)!>/.test(t)};return c(M.div,{...b("right",l,.2),className:"animation-container",children:[n("div",{className:"darkchat-header chat",children:c("div",{className:"top",children:[n(ie,{onClick:()=>{u.set("channels"),O.set(null)}}),c("div",{className:"content",children:[n("div",{className:"title",children:r.streamerMode?"*****":P.name}),c("div",{className:"members",children:[P.members," ",P.members===1?e("APPS.DARKCHAT.MEMBER"):e("APPS.DARKCHAT.MEMBERS")]})]}),n(re,{onClick:()=>{d.PopUp.set({title:e("APPS.DARKCHAT.LEAVE_ROOM"),description:e("APPS.DARKCHAT.LEAVE_ROOM_TEXT"),buttons:[{title:e("APPS.DARKCHAT.CANCEL")},{title:e("APPS.DARKCHAT.LEAVE"),color:"red",cb:()=>{D("DarkChat",{action:"leaveChannel",channel:P.name},!0).then(t=>{if(!t)return h("warning","Failed to leave channel");u.set("channels"),O.set(null);let a=i.APPS.DARKCHAT.channels.value.filter(s=>s.name!==P.name);i.APPS.DARKCHAT.channels.set(a)})}}]})}})]})}),n("div",{className:"chat-wrapper",onScroll:k,children:n("div",{className:"chat-body",children:o.map((t,a)=>{var W;let s,H=null,g=t.sender===C?"self":"other",j=((W=o[a+1])==null?void 0:W.sender)===C?"self":"other";if(o[a+1]?s=Math.abs(t.timestamp-o[a+1].timestamp)/36e5:j=void 0,A(t.content)){let $=t.content.match(/X=(-?\d*\.?\d*)Y/)[1],q=t.content.match(/Y=(-?\d*\.?\d*)!>/)[1];H={x:$,y:q}}return c("div",{className:oe("message",g),children:[H?n("div",{className:"location",onClick:()=>{Y.patch({active:{name:"Maps",data:{location:[H.y,H.x],name:`${t.sender}'s location`}}})},children:n("div",{className:"img",style:{backgroundImage:'url("https://img.gta5-mods.com/q95/images/mirror-park-garden/2b72f9-20160428154103_1.jpg")'}})}):n("div",{className:"content",children:le(t.content)}),o[a+1]&&s>6?c("div",{className:"date",children:[g=="other"&&n("div",{className:"user",children:t.sender}),V(t.timestamp)]}):g!==j&&c("div",{className:"date",children:[g=="other"&&n("div",{className:"user",children:t.sender}),V(t.timestamp)]})]},a)})})}),n("div",{className:"chat-bottom",children:c("div",{className:"input",children:[n(_,{type:"text",placeholder:e("APPS.DARKCHAT.INPUT_PLACEHOLDER"),value:T,ref:v,onChange:t=>p(t.target.value),onKeyDown:t=>{if(t.key==="Enter")return K()}}),c("div",{className:"buttons",children:[n("div",{className:"location",children:n(ce,{onClick:I})}),n("div",{className:"location",onClick:()=>{if(S)return d.Emoji.reset();d.Emoji.set({onSelect:t=>p(a=>`${a}${t.emoji}`)})},children:"ðŸ˜€"}),T.length>0&&n("div",{className:"send",onClick:K,children:n(Ae,{})})]})]})})]})}function me(){const[r,P]=N.useState({username:"",password:""}),C=()=>{D("DarkChat",{action:"login",username:r.username,password:r.password},{success:!0}).then(l=>{l&&l.success?(R.set(r.username),i.APPS.DARKCHAT.username.set(r.username),u.set("channels")):l&&l.reason&&(h("error",l.reason),d.PopUp.set({title:e("APPS.DARKCHAT.ERROR"),description:e(`APPS.DARKCHAT.${l.reason.toUpperCase()}`),buttons:[{title:e("APPS.DARKCHAT.OK")}]}))})};return n(M.div,{...b("right","signin",.2),className:"animation-container",children:c("div",{className:"form",children:[n("div",{className:"form-header",children:n("div",{className:"title",children:e("APPS.DARKCHAT.LOGIN")})}),c("div",{className:"form-content",children:[c("div",{className:"item",children:[n("div",{className:"title",children:e("APPS.DARKCHAT.USERNAME")}),n("div",{className:"input",children:n(_,{type:"text",placeholder:"anonymous",maxLength:50,onChange:l=>{var S;P({...r,username:(S=l.target.value)==null?void 0:S.toLowerCase()})}})})]}),c("div",{className:"item",children:[n("div",{className:"title",children:e("APPS.DARKCHAT.PASSWORD")}),n("div",{className:"input",children:n(_,{type:"password",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",minLength:3,onChange:l=>{P({...r,password:l.target.value})}})})]}),n("div",{className:"button",onClick:()=>C(),children:e("APPS.DARKCHAT.LOGIN")})]}),c("div",{className:"footer",children:[e("APPS.DARKCHAT.NO_ACCOUNT")," ",n("span",{onClick:()=>u.set("signup"),children:e("APPS.DARKCHAT.SIGN_UP")})]})]})})}function ue(){const[r,P]=N.useState({username:"",password:""}),C=()=>{var o;if(r.username===""||r.password==="")return h("warning","Username or password is empty");let l=(o=r==null?void 0:r.username)==null?void 0:o.toLowerCase().replace(/\s/g,""),S=l==null?void 0:l.match(y.value.UsernameFilter);if(!S||(S==null?void 0:S[0])!==l||l.length<3||l.length>15){h("warning","Username did not match regex"),d.PopUp.set({title:e("APPS.DARKCHAT.ERROR"),description:e("APPS.DARKCHAT.USERNAME_NOT_ALLOWED"),buttons:[{title:e("APPS.DARKCHAT.OK")}]});return}D("DarkChat",{action:"register",username:r.username,password:r.password},{success:!0}).then(m=>{if(!m)return h("warning","Darkchat response is null");if(m&&m.success)h("info","Account created successfully"),R.set(r.username),i.APPS.DARKCHAT.username.set(r.username),u.set("channels");else if(m&&m.reason){h("warning",m.reason),d.PopUp.set({title:e("APPS.DARKCHAT.ERROR"),description:e(`APPS.DARKCHAT.${m.reason.toUpperCase()}`),buttons:[{title:e("APPS.DARKCHAT.OK")}]});return}})};return n(M.div,{...b("left","signup",.2),className:"animation-container",children:c("div",{className:"form",children:[n("div",{className:"form-header",children:n("div",{className:"title",children:e("APPS.DARKCHAT.SIGN_UP")})}),c("div",{className:"form-content",children:[c("div",{className:"item",children:[n("div",{className:"title",children:e("APPS.DARKCHAT.USERNAME")}),n("div",{className:"input",children:n(_,{type:"text",placeholder:"anonymous",maxLength:50,onChange:l=>{var S;P({...r,username:(S=l.target.value)==null?void 0:S.toLowerCase()})}})})]}),c("div",{className:"item",children:[n("div",{className:"title",children:e("APPS.DARKCHAT.PASSWORD")}),n("div",{className:"input",children:n(_,{type:"password",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",minLength:3,onChange:l=>{P({...r,password:l.target.value})}})})]}),n("div",{className:"button",onClick:()=>C(),children:e("APPS.DARKCHAT.SIGN_UP")})]}),c("div",{className:"footer",children:[e("APPS.DARKCHAT.ALREADY_HAVE")," ",n("span",{onClick:()=>u.set("signin"),children:e("APPS.DARKCHAT.LOGIN")})]})]})})}const Ce={channels:n(Pe,{}),chat:n(he,{}),signin:n(me,{}),signup:n(ue,{})},u=G("signup"),O=G(null),R=G(null);function De(){const r=E(u),[P,C]=N.useState(""),[l,S]=N.useState(!0);return N.useEffect(()=>{if(i.APPS.DARKCHAT.username.value){R.set(i.APPS.DARKCHAT.username.value),S(!1);return}D("DarkChat",{action:"getUsername"},X.username).then(o=>{if(S(!1),!o||!(o!=null&&o.username))return h("warning","Darkchat response is null");R.set(o.username),i.APPS.DARKCHAT.username.set(o.username),o.password?u.set("channels"):d.PopUp.set({title:e("APPS.DARKCHAT.SET_PASSWORD_POPUP.TITLE"),description:e("APPS.DARKCHAT.SET_PASSWORD_POPUP.DESCRIPTION"),input:{type:"password",placeholder:e("APPS.DARKCHAT.SET_PASSWORD_POPUP.PLACEHOLDER"),minLength:3,maxLength:50,onChange:m=>C(m)},buttons:[{title:e("APPS.DARKCHAT.SET_PASSWORD_POPUP.TITLE"),cb:()=>{C(m=>(D("DarkChat",{action:"setPassword",password:m},{success:!0}).then(T=>{if(!T||T!=null&&T.reason)return h("error",T.reason);u.set("channels")}),""))}}]})})},[]),L("darkChat:addChannel",o=>{!o||i.APPS.DARKCHAT.channels.value||i.APPS.DARKCHAT.channels.set([o,...i.APPS.DARKCHAT.channels.value])}),L("darkchat:leaveChannel",o=>{if(!o)return h("warning","No channel provided to leave");if(!i.APPS.DARKCHAT.channels.value)return h("warning","No channels stored in cache to leave");i.APPS.DARKCHAT.channels.set(i.APPS.DARKCHAT.channels.value.filter(m=>m.name!==o))}),L("darkchat:logout",o=>{if(!o)return h("warning","No username provided to logout");if(!R.value)return h("warning","No username stored in cache to logout");if(o!==(R==null?void 0:R.value))return h("warning","Username provided does not match current logged in username, not logging out");R.set(null),u.set("signin"),i.APPS.DARKCHAT.username.set(null),i.APPS.DARKCHAT.channels.set(null)}),n("div",{className:"darkchat-container",children:!l&&Ce[r]})}export{O as ActiveChannel,R as Username,u as View,De as default};
